# NewsFeed

## 1. **Выбор темы**
- Аналог новостной ленты социальной сети vk.com - NewsFeed
## 2. **Определение возможного диапазона нагрузок подобного проекта**
Примечание: так как сервис новостной ленты входит в vk.com, то можно считать что количество посещений vk.com в целом равно количеству посещений сервиса новостной ленты. Отличие будет в том, сколько в среднем времени проводится пользователем в новостной ленте относительно всего приложения/других сервисов vk.com
- Дневная аудитория - [43.3% населения России](https://popsters.ru/blog/post/svezhie-dannye-o-vk) - 62 млн пользователей
- Месячная аудитория - [71.8% населения России](https://popsters.ru/blog/post/svezhie-dannye-o-vk) - 104 млн пользователей
- [30 минут в день](https://www.emarketer.com/content/emarketer-reduces-us-time-spent-estimates-for-facebook-and-snapchat) - столько среднестатистический пользователь проводит время в новостной ленте

## 3. **Выбор планируемой нагрузки - 50% доля рынка России**
Самые крупные сервисы:
- Vk.com - 43.3% - 62 млн ежедн.
- Instagram - 26.9% - 39 млн ежедн.
- Ok.ru - 16.9% - 24 млн ежедн. 
Планируемая нагрузка - 49.6% ~ 50% доля рынка в России.

[Источник: Mediascope](https://popsters.ru/blog/post/svezhie-dannye-o-vk)

Новостная лента у всех пользователей очень и очень разная. Посты ленты могут состоять как из текста, так и из музыки и видео.
1) Большинство песен имеют качество кодирования 320 Кбит/с, где одна минута песни весит около 2,3 - 2,4 мегабайта.
За час прослушивания музыки израсходуется ~ 140 мегабайта трафика.
2) В среднем одно изображение из ленты занимает 150 Кб, за минуту можно посмотреть около 12 изображений, где на каждую картинку уйдет ~ 5 секунд просмотра. Получаем 12 изобр * 150 Кб * 60 = 144000 Кб за час = 100Мб за час
3) При среднем выборе качества 480p видео потока, это займет [700Мб за час](https://www.cloudav.ru/mediacenter/security/mobile-data-streaming-media/)
4) Текстовые посты как и простые сообщения занимают от [2 до 10 Мб](https://teztele.com/skolko-internet-trafika-potreblyayut-populyarnye-prilozheniya/) за час, возьмем 5 Мб.
Теперь пусть новостная лента равномерно распределяет аудио, изобрежения, видео и текст. (140 Мб + 100 Мб + 700 Мб + 5 мб) / 4 = 236 Мб за час.
### Посчитаем дневную нагрузку:
- 62 млн * (30 минут / 60 минут) * 236 Мб = 6977 Тб в день. 
### За секунду:
- 6977 / 86400  = 0.08075 Тб/с ~ 80 Гб/с
- 80 Гб /с * 8 = 640 Гбит/с

## 4. ** Логическая схема базы данных (без выбора СУБД) **
Так как подборка фида операция дорогая, запросы будут тяжелые и кэширование мало чем поможет (так как посты друзей и групп меняются очень и очень часто), то целесообразно будет выбрать нереляционную базу данных с хранением JSON-подобных документов со всеми постами пользователя/группы в рамках одного документа:
 

